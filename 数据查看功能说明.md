# 数据查看功能改动说明

## 本次新增/修改
- 新增统计响应模型与通用响应包装：`app/schemas/stats_schema.py`
- 新建统计数据表并落库测试数据（MySQL）：`user_profiles`、`behavior_logs`、`search_logs`
- 数据查看服务逻辑改为真实数据库查询：`app/services/viewer_service.py`
- 新增数据查看接口：
  - `GET /api/v1/viewer/user-profile`
  - `GET /api/v1/viewer/user-behavior`
  - `GET /api/v1/viewer/search-summary`
- 种子脚本：`scripts/seed_stats_data.py`（创建表并写入测试数据，已执行）

## 接口速览

### 1) 用户基础数据统计
- 路径：`GET /api/v1/viewer/user-profile`
- 参数：
  - `startTime`/`endTime` (必填，毫秒时间戳)
  - `dimensions` (可选，逗号分隔：`gender,age,city`，未传返回全部支持项)
- 响应：`{code, msg, data}`，`data` 包含 `totalUsers`、`newUsers`、`genderDist`、`ageDist`
  - 支持 `city` 维度时额外返回 `cityDist`

### 2) 用户行为数据统计
- 路径：`GET /api/v1/viewer/user-behavior`
- 参数：
  - `startTime`/`endTime` (必填，毫秒时间戳)
  - `granularity` (必填：`hour`/`day`/`week`)
- 响应：`{code, msg, data}`，`data.summary`（`totalPV`,`totalUV`,`avgDuration`）、`data.trend`（`dates/pvValues/uvValues`）、`data.retention`（`day1/day7`）

### 3) 用户搜索数据统计
- 路径：`GET /api/v1/viewer/search-summary`
- 参数：
  - `startTime`/`endTime` (必填，毫秒时间戳)
  - `granularity` (可选，默认 `day`，支持 `hour/day/week`)
- 响应：`{code, msg, data}`，`data.summary`（`totalSearchPv`、`totalSearchUv`、`avgSearchPerUser`）、`data.trendList`（`datetime/count/userCount`）

## 数据说明
- 数据来源：MySQL，本地运行 `PYTHONPATH=. python scripts/seed_stats_data.py` 已创建表并写入 8 条用户、7 条行为、12 条搜索记录。
- 时间参数校验：`startTime > endTime` 会返回 400。
- 粒度校验：不在 `hour/day/week` 范围会返回 400。

## 相关文件
- `app/schemas/stats_schema.py`
- `app/services/viewer_service.py`
- `app/api/v1/endpoints/viewer.py`
